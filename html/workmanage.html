<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
	<script src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
	<script src="http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>


	<title>Title</title>

</head>

<body>
	<div class="container">
		<div class="row container form">
			<input type="text" name="workName" id="text" />
			<button id="workquery" class="btn btn-info btn-lg text-right">作品查询</button>
		</div>
		<br/> <br/> <br/>
		<div class="row container" id="findresult" style="height: 500px;">
			<table class="table">
				<thead>
					<tr>
						<th>作品ID</th>
						<th>作品名称</th>
						<th><button id="addfun" class="btn btn-info btn-lg text-right">添加作品</button></th>
					</tr>
				</thead>
				<tbody></tbody>
			</table><br/>
			<div id="pages"></div>
		</div>
		<div id="addwork" hidden>
			<form method="post" enctype="multipart/form-data" class="form" action="/work/add">
				作品名称:<input type="text" name="workName" /><br/> 
				作品库存:<input type="number" name="workStock" /> <br/> 
				作品pdf文件路径:<input type="text" name="workPdfpath" /><br/> 
				作品封面图片:<input type="file" accept="image/*" name="coverFile" /><br/>
				作品概要:<input type="text" name="workSummary" /><br/>
				作品图片:<input type="file" accept="image/*" name="imageFiles" /><br/>
				<input type="file" accept="image/*" name="imageFiles" /><br/>
				<input type="file" accept="image/*" name="imageFiles" /><br/>
				<input type="file" accept="image/*" name="imageFiles" /><br/>
				<input type="submit" class="btn btn-info btn-lg" value="确认添加" />
			</form>
		</div>
		<form action="work/remove" method="post" id="removeForm">
			<input type="hidden" name="workId" id="removeWorkId" />
		</form>
	</div>
	<script>
		$(function () {
			let page = 1;
			let ajaxOpt = {
				type: "post",
				url: "work/ajax",
				contentType: "application/json;charset=utf-8",
				dataType: "json",
				data: '{"workName":"' + $("#text").val() + '","page":"' + page + '"}',
				success: handleData,
			};
			$.ajax(ajaxOpt);
			$("#pages").on("click", function (event) {
				if (isNaN($(event.target).text())) {
					return;
				}
				page = $(event.target).text();
				ajaxOpt.data = '{"workName":"' + $("#text").val() + '","page":"' + page + '"}';
				$.ajax(ajaxOpt);
			});
			//查询全表
			$("#workquery").click(function () {
				ajaxOpt.data = '{"workName":"' + $("#text").val() + '","page":"' + page + '"}';
				$.ajax(ajaxOpt);
			});
			$(".btn-primary").click(function (event) {
				$.ajax({
					type: "post",
					url: "work/detail/ajax",
					contentType: "application/json;charset=utf-8",
					dataType: "json",
					data: '{"workId":"' + $(event.target).data("workid") + '"}',
					async: false,
					success: function (data) {
						let work = data.work;
						let detail = `<div>
							作品名称:<div>${work.workName}</div>
							作品上传时间:<div>${work.workUploadTime}</div>
							作品pdf路径:<div>${work.workPdfpath}</div>
						</div>`;
						$("#findresult").html(detail);
					},
					error: function (data) {
						console.log(data);
					}
				});
			});
			//添加菜单展开
			$("#addfun").click(function () {
				$("#findresult").remove();
				$("#addwork").show();
			});
			//删除功能
			$(".btn-danger").click(function () {
				$("#removeWorkId").val($(event.target).data("workid"));
				$("#removeForm").submit();
			});
			function handleData(data) {
				if (data.errInfo) {
					$(".table tbody").empty();
					return;
				}
				let str = "";
				for (let work of data.result) {
					str += `<tr>
						<td>${work.workId}</td>
						<td>${work.workName}</td>
						<td>
							<button data-workid=${work.workId} class='btn btn-primary btn-lg text-right'>作品信息</button>
							<button data-workid=${work.workId} class='btn btn-danger btn-lg text-right'>删除作品</button>
						</td>
					</tr>`;
				}
				$(".table tbody").empty();
				$(".table tbody").append(str);
				let pages = "";
				if (data.nowPage - 1 > 0) {
					pages += `<a href="javascript:void(0)">${data.nowPage - 1}</a>`;
				}
				pages += `  <span>${data.nowPage}</span>`;
				if (data.nowPage + 1 <= data.totalPage) {
					pages += `  <a href="javascript:void(0)">${data.nowPage + 1}</a>`;
				}
				$("#pages").html(pages);
				$("#text").val(data.workName);
			}
		});
	</script>

</body>

</html>